// dashboard setup
// function dashsetup() {
//   $("#day-schedule").dayScheduleSelector({
//     days: [0, 1, 2, 3, 4, 5, 6],
//     interval: 60,
//     startTime: '06:00',
//     endTime: '24:00'
//   });
//   const calendar = '{{ jsoncalendar|safe }}'
//   const parsed = JSON.parse(calendar)
//   console.log(calendar, parsed)

//   $("#day-schedule").data("artsy.dayScheduleSelector").deserialize(parsed);
//   $("#day-schedule").on('selected.artsy.dayScheduleSelector', function (e, selected) {
//     console.log(selected);
//   })
  
// }
let request = null;
// from buddies.html
// Submits a request when "Match" button is pressed
function makeMatch() {
  const calendar = $("#day-schedule").data("artsy.dayScheduleSelector").serialize();
  let destnetid = $('#matchRequest').val();
  let sessionindex = $('#indexInput').val();
  console.log(destnetid)
  if (request != null)
    request.abort();

  $.ajax({
    type:'POST',
    url:'/matching/findabuddy',
    data: { "destnetid": destnetid, "index": sessionindex, "jsoncalendar": JSON.stringify(calendar) },
    error: function(xhr, textstatus, errorthrown) {
      console.log(xhr, textstatus, errorthrown)
    }
  })
}

// from findabuddy.html
// goes to profile
  function goProfile() {
    request = $.ajax(
      {
        url: '/home/profile'
      }
    );
  }

  // sends a match request by submitting data to "/matching/findabuddy"
  function sendReq()
  {
    let destnetid = $('#matchRequest').val();
    let sessionindex = $('#indexInput').val();
    console.log(destnetid)
    if (request != null)
      request.abort();
    request = $.ajax(
      {
        type: 'POST',
        data: {"destnetid": destnetid, "index": sessionindex},
        url: '/matching/findabuddy'
      }
    );
  }

  // takes response generated by getBuddies() and inserts html in #buddies span tag above
  function listBuddies(response)
  {
    $('#buddies').html(response);
  }

  // gets the next potential match from list
  function getBuddies()
  {
    let sessionindex = $('#indexInput').val();
    console.log(sessionindex)
    if (request != null)
      request.abort();


    $("body").addClass("wait");
    request = $.ajax(
      {
        type: 'GET',
        data: {"index": sessionindex},
        url: '/matching/buddies',
        success: listBuddies,
        complete: function() { $("body").removeClass("wait"); },
      }
    );
  }

// from incoming.html
  function fillCard(response) {
    console.log("got a response");
    $('#userPopup').html(response);
  }

  function getCard(requestid) {
    if (getrequest != null) {
      console.log("aborting other getrequests!");
      getrequest.abort();
    }

    getrequest = $.ajax({
      type: 'GET',
      data: {"requestid": requestid},
      url: "{{ url_for('matching.incomingmodal') }}",
      success: fillCard,
      complete: function() { getrequest = null; },
      error: function() { console.log("getCard failed!"); },
      timeout: 3000,
    });
  }

  function listRequests(response) {
    if (response) {
      lastrefreshed = Date.now();
      $('#requestTable').html(response);
      console.log("making an update now!", Date.now())
    }
  }

// from matched.html
// generates list of matches
function listMatches(response) {
  if (response) {
    lastrefreshed = Date.now();
    $('#matchesTable').html(response);
    console.log("making an update now!", Date.now())
  }
}





