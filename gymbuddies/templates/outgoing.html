{% extends 'layout.html' %}
{% block title %}Outgoing Requests{% endblock %}
{% block classdash %}<a class="nav-link" href="../home">{% endblock %}
  {% block classfind %}<a class="nav-link " href="{{ url_for('matching.search') }}">{% endblock %}
  {% block classreq %}<a class="nav-link " href="{{ url_for('matching.pending') }}">{% endblock %}
  {% block classreqa %}<a class="nav-link active" href="{{ url_for('matching.outgoing') }}">{% endblock %}
  {% block classmat %}<a class="nav-link" href="{{ url_for('matching.matched') }}">{% endblock %}
  {% block classprof %}<a class="nav-link " href="{{ url_for('home.profile') }}">{% endblock %}
  {% block classmast %}<a class="nav-link " href="{{ url_for('master.show') }}">{% endblock %}
{% block pagename %}<li class="breadcrumb-item text-sm text-white active" aria-current="page">Outgoing Requests</li>{% endblock %}
{% block pagename_large %}Outgoing Requests{% endblock %}

{% block content %}
    <div class="row">
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-header pb-0">
            <h6>Outgoing Requests</h6>
          </div>
          <div class="card-body px-0 pt-0 pb-2">
            <span id="outgoingTable"></span>
          </div>
        </div>
      </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
  let lastrefreshed = 0;
  let getrequest = null;
  let postrequest = null;

  function listOutgoing(response)
  {
    if (response) { // if response is empty, then no update is necessary
      lastrefreshed = Date.now();
      $('#outgoingTable').html(response);
    }
  }


  function reject(requestid, el)
  {
    if (postrequest != null)
      return

    postrequest = $.ajax(
      {
        type: 'POST',
        data: {"requestid": requestid, "action": "reject"},
        url: '/matching/outgoingtable',
        success: listOutgoing,
        complete: function () { postrequest = null; console.log(el.css); },
        timeout: 3000,
      }
    );
  }

  function refreshOutgoing()
  {
    if (getrequest != null || postrequest != null)
      getrequest.abort();

    getrequest = $.ajax(
      {
        type: 'GET',
        data: {"lastrefreshed": lastrefreshed},
        url: '/matching/outgoingtable',
        success: listOutgoing,
        getrequest: function() { getrequest = null; },
        timeout: 3000,
      }
    );
  }

  function setup()
  {
    refreshOutgoing();
    window.setInterval(refreshOutgoing, 1000);
  }
  $('document').ready(setup);
</script>
{% endblock %}
